<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מנהיגי ישראל: ראשי ממשלה ונשיאים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* <!-- Chosen Palette: Deep Forest Green (כהה וריכוזי) --> */
        :root {
            --bg-dark: #1A321F;         /* רקע ראשי (ירוק כהה, כמעט ירוק יער) */
            --bg-card: #294B34;         /* רקע לכרטיסים (ירוק זית כהה) */
            --accent-primary: #6AA84F;  /* ירוק זרחני/בהיר (להדגשה וקריאה לפעולה) */
            --accent-dark: #E0EFE0;     /* צבע לטקסט ולכותרות ראשיות (אוף-וויט ירקרק) */
            --text-light: #E0EFE0;      /* טקסט ראשי (אוף-וויט ירקרק) */
            --text-dim: #B0C4B0;        /* טקסט משני (ירוק בהיר מושתק) */
            
            /* צבעי משוב לבדיקת ידע */
            --color-correct: #3CB371;   /* ירוק ביניים (לשמירה על ניגודיות טובה) */
            --color-incorrect: #CC5252; /* אדום כהה יותר (לשמירה על ניגודיות) */
            
            /* צבעי הדגשה עבור ההערה */
            --emphasis-bg: #004D25;       /* ירוק אזמרגד כהה (רקע להערה) */
            --emphasis-text: #E0EFE0;     /* טקסט בהיר */
            --emphasis-border: #6AA84F;   /* גבול בצבע ההדגשה הראשי */
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* הסתרת פס גלילה אך שמירה על פונקציונליות */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* סגנון מיוחד לעמודת הנשיא הממוזגת (הדגשת ה-rowspan) */
        .president-cell {
            background-color: var(--bg-card);
            color: var(--accent-dark);
            font-weight: bold;
            vertical-align: top !important;
            text-align: center;
            border-left: 2px solid var(--accent-primary);
        }
        
        /* הוספה מיוחדת לטבלה כדי לשפר נראות בטלפון */
        .timeline-table td, .timeline-table th {
            padding: 0.75rem 1rem;
        }
        
        @media (max-width: 640px) {
            .timeline-table td, .timeline-table th {
                padding: 0.5rem 0.5rem;
                font-size: 0.875rem;
            }
            .nav-tabs {
                justify-content: space-around;
            }
        }

        /* סגנון לקלט המבחן */
        .quiz-input {
            background-color: var(--bg-dark);
            color: var(--text-light);
            border: 1px solid var(--text-dim);
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
            text-align: center;
            transition: all 0.3s;
        }
        /* הדגשת שדה קלט נכון */
        .quiz-input.correct {
            background-color: var(--color-correct)30; /* 18% opacity */
            border-color: var(--color-correct);
        }
        /* הדגשת שדה קלט שגוי */
        .quiz-input.incorrect {
            background-color: var(--color-incorrect)30; /* 18% opacity */
            border-color: var(--color-incorrect);
        }
        /* הדגשת שורה נכונה/שגויה */
        .quiz-result-correct {
            border-bottom: 2px solid var(--color-correct);
        }
        .quiz-result-incorrect {
            border-bottom: 2px solid var(--color-incorrect);
        }
        
        /* Flashcard specific CSS for flip effect */
        .perspective-1000 {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="shadow-lg sticky top-0 z-50" style="background-color: var(--bg-card); border-color: var(--accent-primary); border-bottom: 1px solid var(--accent-primary);">
        <div class="container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center">
            <div class="mb-2 sm:mb-0">
                <h1 class="text-2xl font-bold" style="color: var(--accent-dark);">מנהיגי ישראל</h1>
                <p class="text-xs" style="color: var(--text-dim);">כרונולוגיה של ראשי ממשלה ונשיאים</p>
            </div>
            <!-- Mobile Menu / Tabs -->
            <nav class="flex space-x-2 space-x-reverse rounded-lg p-1 nav-tabs" style="background-color: var(--bg-dark);">
                <button onclick="switchTab('timeline')" id="btn-timeline" class="px-3 py-2 rounded-md text-sm font-medium transition-colors shadow-md" style="background-color: var(--accent-primary); color: var(--bg-dark);">רשימה</button>
                <button onclick="switchTab('flashcards')" id="btn-flashcards" class="px-3 py-2 rounded-md text-sm font-medium transition-colors" style="color: var(--text-dim); background-color: transparent;">כרטיסיות</button>
                <button onclick="switchTab('ordering')" id="btn-ordering" class="px-3 py-2 rounded-md text-sm font-medium transition-colors" style="color: var(--text-dim); background-color: transparent;">סדר כרונולוגי</button>
                <button onclick="switchTab('quiz')" id="btn-quiz" class="px-3 py-2 rounded-md text-sm font-medium transition-colors" style="color: var(--text-dim); background-color: transparent;">מבחן</button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-6">

        <!-- VIEW 1: TIMELINE (The Consolidated Table) -->
        <section id="view-timeline" class="block">
            <div class="mb-6 p-4 rounded-xl border-r-4" style="background-color: var(--bg-card); border-color: var(--accent-primary);">
                <h2 class="text-xl font-bold mb-2" style="color: var(--accent-dark);">רשימה כרונולוגית (ממוזגת)</h2>
                <p class="text-sm leading-relaxed mb-3" style="color: var(--text-dim);">
                    מקטע זה מציג את סדר כהונתם של ראשי ממשלת ישראל. הנשיאים מוצגים במבנה ממוזג (rowspan) כדי להדגיש את החפיפה. 
                </p>
                <!-- ההערה המודגשת, עם גוונים ירוקים -->
                <div class="p-3 rounded-xl border-2 shadow-inner" style="background-color: var(--emphasis-bg); border-color: var(--emphasis-border);">
                    <strong class="text-base font-extrabold block mb-1" style="color: var(--emphasis-text);">שימו לב להבדלי המיזוג (Rowspan):</strong>
                    <span class="text-sm leading-relaxed" style="color: var(--emphasis-text);">
                        הנשיא ראובן ריבלין כיהן כנשיא רק מעט בתפקידו כפי שמשתקף במיזוגו (שורה אחת). 
                        לאחר פרישתו, הנשיא יצחק הרצוג המשיך לכהן, בזמן שראש הממשלה בנימין נתניהו המשיך בכהונתו. 
                        הרצוג המשיך לכהן גם בתקופת ראשי הממשלה הבאים (בנט, לפיד, ונתניהו שוב), ולכן הוא ממוזג על מספר שורות רב יותר.
                    </span>
                </div>
            </div>

            <div class="overflow-x-auto rounded-xl border shadow-2xl" style="border-color: var(--accent-primary);">
                <table class="w-full text-right min-w-[500px] timeline-table" style="background-color: var(--bg-card);">
                    <thead style="background-color: var(--bg-dark); color: var(--accent-dark);">
                        <tr>
                            <th class="py-4 px-4 font-bold border-b" style="border-color: var(--bg-card);">#</th>
                            <th class="py-4 px-4 font-bold border-b" style="border-color: var(--bg-card);">ראש ממשלה</th>
                            <th class="py-4 px-4 font-bold border-b w-1/3" style="border-color: var(--bg-card);">נשיא מכהן</th>
                        </tr>
                    </thead>
                    <tbody id="timeline-body" style="color: var(--text-light);">
                        <!-- Data will be injected here via JS with Rowspan -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- VIEW 2: FLASHCARDS (Study Tool) -->
        <section id="view-flashcards" class="hidden">
            <div class="mb-6 text-center">
                <h2 class="text-xl font-bold" style="color: var(--accent-dark);">כרטיסיות ושינון</h2>
                <p class="text-sm leading-relaxed" style="color: var(--text-dim);">
                    <strong>שיטות למידה:</strong> נסו לשייך מילה, אירוע היסטורי או רעיון משותף לכל צמד מנהיגים כדי לחזק את הזיכרון. 
                    לחצו על הכרטיס כדי לחשוף את הנשיא שכיהן במקביל לראש הממשלה.
                </p>
            </div>

            <!-- Flashcard Container -->
            <div class="flex flex-col items-center justify-center min-h-[400px]">
                <div class="group w-full max-w-sm h-64 cursor-pointer perspective-1000" onclick="flipCard()">
                    <div id="flashcard-inner" class="relative w-full h-full duration-500 transform-style-3d shadow-xl rounded-2xl">
                        <!-- Front of Card (PM) -->
                        <div class="absolute w-full h-full rounded-2xl p-6 flex flex-col items-center justify-center backface-hidden" 
                             style="background-color: var(--bg-card); border: 2px solid var(--accent-primary);">
                            <span class="text-sm font-bold tracking-wider mb-4" style="color: var(--text-dim);">ראש ממשלה</span>
                            <h3 id="card-pm" class="text-3xl font-extrabold text-center" style="color: var(--text-light);">--</h3>
                            <div class="mt-6 text-xs" style="color: var(--text-dim);">לחץ לחשיפת הנשיא</div>
                        </div>
                        <!-- Back of Card (President) -->
                        <div class="absolute w-full h-full rounded-2xl p-6 flex flex-col items-center justify-center backface-hidden rotate-y-180" 
                             style="background-color: var(--accent-primary); color: var(--bg-dark);">
                            <span class="text-sm font-bold tracking-wider mb-4">נשיא מכהן</span>
                            <h3 id="card-president" class="text-3xl font-extrabold text-center">--</h3>
                            <div class="mt-6 text-xs" style="color: var(--bg-dark)90;">לחץ לחזרה</div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center space-x-4 space-x-reverse mt-8">
                    <button onclick="prevCard()" class="p-3 rounded-full transition shadow-lg" style="background-color: var(--bg-card); color: var(--accent-dark);">
                        &#8594; הקודם
                    </button>
                    <span id="card-counter" class="font-mono" style="color: var(--text-dim);">1 / 20</span>
                    <button onclick="nextCard()" class="p-3 rounded-full transition shadow-lg" style="background-color: var(--accent-primary); color: var(--bg-dark);">
                        הבא &#8592;
                    </button>
                </div>

                <button onclick="shuffleCards()" class="mt-6 text-sm underline" style="color: var(--accent-primary);">ערבב כרטיסים</button>
            </div>
        </section>

        <!-- VIEW 3: ORDERING CHALLENGE (New Learning Option) -->
        <section id="view-ordering" class="hidden">
            <div class="mb-6 p-4 rounded-xl border-r-4" style="background-color: var(--bg-card); border-color: var(--accent-primary);">
                <h2 class="text-xl font-bold mb-2" style="color: var(--accent-dark);">אתגר הסדר הכרונולוגי</h2>
                <p class="text-sm leading-relaxed mb-3" style="color: var(--text-dim);">
                    לחצו על ראשי הממשלה בסדר הכרונולוגי הנכון, מהראשון (בן גוריון) עד האחרון (נתניהו בכהונתו הנוכחית).
                </p>
                <div id="ordering-results" class="mt-4 text-base font-bold text-center p-3 rounded-lg border-2" style="background-color: var(--bg-dark); border-color: var(--accent-primary); color: var(--accent-dark);">
                    לחצו על ראשי הממשלה בסדר כרונולוגי נכון.
                </div>
                <button onclick="renderOrderingGame()" class="mt-4 px-6 py-2 font-bold rounded-lg shadow-md transition-colors" style="background-color: var(--accent-primary); color: var(--bg-dark);">
                    התחלת אתגר חדש (ערבוב מחדש)
                </button>
            </div>

            <!-- Ordering Grid -->
            <div id="ordering-column" class="flex flex-wrap gap-4 justify-center">
                <!-- PM items will be injected here -->
            </div>
        </section>
        
        <!-- VIEW 4: QUIZ (Test Feature - Free Text Input) -->
        <section id="view-quiz" class="hidden">
            <div class="mb-6 p-4 rounded-xl border-r-4" style="background-color: var(--bg-card); border-color: var(--accent-primary);">
                <h2 class="text-xl font-bold mb-2" style="color: var(--accent-dark);">מבחן ידע: מילוי טבלה חופשי</h2>
                <p class="text-sm leading-relaxed" style="color: var(--text-dim);">
                    מלאו את הטבלה כולה מהזיכרון. המערכת תזהה את התשובות הנכונות גם אם יש שגיאות כתיב קלות. תשובות נכונות יסומנו ב<span style="color: var(--color-correct); font-weight: bold;">ירוק</span> ושגויות ב<span style="color: var(--color-incorrect); font-weight: bold;">אדום כהה</span>.
                </p>
                <button onclick="checkQuiz()" class="mt-4 px-6 py-2 font-bold rounded-lg shadow-md transition-colors" style="background-color: var(--accent-primary); color: var(--bg-dark);">
                    בדיקת תשובות וקבלת ציון
                </button>
                <div id="quiz-results" class="mt-4 text-lg font-bold"></div>
            </div>

            <div class="overflow-x-auto rounded-xl border shadow-2xl" style="border-color: var(--accent-primary);">
                <form id="quiz-form" onsubmit="event.preventDefault(); checkQuiz();">
                    <table class="w-full text-right min-w-[500px] timeline-table" style="background-color: var(--bg-card);">
                        <thead style="background-color: var(--bg-dark); color: var(--accent-dark);">
                            <tr>
                                <th class="py-4 px-4 font-bold border-b" style="border-color: var(--bg-card);">#</th>
                                <th class="py-4 px-4 font-bold border-b" style="border-color: var(--bg-card);">ראש ממשלה (כתיבה חופשית)</th>
                                <th class="py-4 px-4 font-bold border-b w-1/3" style="border-color: var(--bg-card);">נשיא מכהן (כתיבה חופשית)</th>
                            </tr>
                        </thead>
                        <tbody id="quiz-body" style="color: var(--text-light);">
                            <!-- Quiz rows will be injected here -->
                        </tbody>
                    </table>
                </form>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="py-6 text-center" style="background-color: var(--bg-dark); border-top: 1px solid var(--bg-card);">
        <p class="text-sm" style="color: var(--text-dim);">נוצר על בסיס נתוני רשימת ראשי הממשלה והנשיאים</p>
    </footer>

    <script>
        // --- Data Source ---
        const rawData = [
            { pm: "דוד בן גוריון", pres: "חיים ויצמן" },
            { pm: "משה שרת", pres: "יצחק בן צבי" },
            { pm: "דוד בן גוריון", pres: "יצחק בן צבי" },
            { pm: "לוי אשכול", pres: "זלמן שזר" },
            { pm: "גולדה מאיר", pres: "אפרים קציר" },
            { pm: "יצחק רבין", pres: "אפרים קציר" },
            { pm: "מנחם בגין", pres: "יצחק נבון" },
            { pm: "יצחק שמיר", pres: "חיים הרצוג" },
            { pm: "שמעון פרס", pres: "חיים הרצוג" },
            { pm: "יצחק שמיר", pres: "חיים הרצוג" },
            { pm: "יצחק רבין", pres: "עזר ויצמן" },
            { pm: "שמעון פרס", pres: "עזר ויצמן" },
            { pm: "בנימין נתניהו", pres: "עזר ויצמן" },
            { pm: "אהוד ברק", pres: "משה קצב" },
            { pm: "אריאל שרון", pres: "משה קצב" },
            { pm: "אהוד אולמרט", pres: "שמעון פרס" },
            { pm: "בנימין נתניהו", pres: "ראובן ריבלין" }, // Group size 1
            { pm: "נפתלי בנט", pres: "יצחק הרצוג" },
            { pm: "יאיר לפיד", pres: "יצחק הרצוג" },
            { pm: "בנימין נתניהו", pres: "יצחק הרצוג" }  // Group size 3
        ];

        // --- Global State & DOM Elements ---
        const groupedData = groupData(rawData);
        let currentCardIndex = 0;
        let cardData = [...rawData]; 
        
        // Ordering Game State
        const correctOrderPMs = rawData.map(d => d.pm);
        let shuffledPMs = [...correctOrderPMs];
        let currentTargetIndex = 0; // Index in the correctOrderPMs array
        
        const views = {
            timeline: document.getElementById('view-timeline'),
            flashcards: document.getElementById('view-flashcards'),
            ordering: document.getElementById('view-ordering'), // New
            quiz: document.getElementById('view-quiz')
        };
        const buttons = {
            timeline: document.getElementById('btn-timeline'),
            flashcards: document.getElementById('btn-flashcards'),
            ordering: document.getElementById('btn-ordering'), // New
            quiz: document.getElementById('btn-quiz')
        };
        const cardInner = document.getElementById('flashcard-inner');
        const cardPM = document.getElementById('card-pm');
        const cardPres = document.getElementById('card-president');
        const cardCounter = document.getElementById('card-counter');
        const quizBody = document.getElementById('quiz-body');
        const quizResults = document.getElementById('quiz-results');
        const orderingColumn = document.getElementById('ordering-column'); // New
        const orderingResults = document.getElementById('ordering-results'); // New


        // --- Data Grouping (Logic for Consolidated Table/Quiz Structure) ---
        function groupData(data) {
            const groups = [];
            let currentPresident = null;
            
            data.forEach(item => {
                // Special handling for the change from Rivlin to Herzog during Netanyahu's 5th term
                if (item.pm === "בנימין נתניהו" && item.pres === "ראובן ריבלין" && groups.length > 0 && groups[groups.length - 1].pres === "שמעון פרס") {
                    // Start a new group for Netanyahu/Rivlin (row 17)
                    currentPresident = { pres: item.pres, pms: [] };
                    groups.push(currentPresident);
                } else if (item.pres === "יצחק הרצוג" && item.pm === "בנימין נתניהו" && groups.length > 0 && groups[groups.length - 1].pres === "יאיר לפיד") {
                    // Continue the existing Herzog group for Netanyahu's 6th term (row 20)
                    groups[groups.length - 1].pms.push(item.pm);
                    return;
                } else if (!currentPresident || currentPresident.pres !== item.pres) {
                    currentPresident = { pres: item.pres, pms: [] };
                    groups.push(currentPresident);
                }
                currentPresident.pms.push(item.pm);
            });
            return groups;
        }

        // --- Array Helper ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // --- Initialization ---
        function init() {
            renderTimeline();
            renderQuizTable(); 
            updateCard();
            renderOrderingGame(); // New initialization
        }

        // --- Levenshtein Distance for Fuzzy Matching ---
        /**
         * מחשב את מרחק לוינשטיין בין שתי מחרוזות.
         */
        function levenshteinDistance(s1, s2) {
            s1 = s1.toLowerCase().replace(/\s/g, '');
            s2 = s2.toLowerCase().replace(/\s/g, '');

            const costs = [];
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0) {
                        costs[j] = j;
                    } else if (j > 0) {
                        let newValue = costs[j - 1];
                        if (s1[i - 1] !== s2[j - 1]) {
                            newValue = Math.min(newValue, lastValue, costs[j]) + 1;
                        }
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                    }
                }
                if (i > 0) {
                    costs[s2.length] = lastValue;
                }
            }
            return costs[s2.length];
        }

        /**
         * משווה מחרוזת של משתמש מול תשובה נכונה עם סובלנות לשגיאות כתיב.
         */
        function normalizeAndCompare(userStr, correctStr) {
            if (!userStr || !correctStr) return false;

            // ניקוי: הסרת תווים שאינם אותיות עבריות (כולל ניקוד, למרות שסביר שלא יהיה).
            const cleanUser = userStr.replace(/[^\u0590-\u05FF]/g, '').toLowerCase();
            const cleanCorrect = correctStr.replace(/[^\u0590-\u05FF]/g, '').toLowerCase();

            if (cleanUser.length === 0 || cleanCorrect.length === 0) return false;

            const distance = levenshteinDistance(cleanUser, cleanCorrect);
            
            // הגדרת סובלנות:
            let tolerance;
            if (cleanCorrect.length < 5) {
                tolerance = 0; // חובה מדויק לשמות קצרים
            } else if (cleanCorrect.length < 10) {
                tolerance = 1; // שגיאה אחת מותרת
            } else {
                tolerance = 2; // שתי שגיאות מותרות לשמות ארוכים
            }

            return distance <= tolerance;
        }

        // --- Tab Switching Logic ---
        window.switchTab = function(tabName) {
            Object.keys(views).forEach(key => {
                views[key].classList.toggle('hidden', key !== tabName);
                views[key].classList.toggle('block', key === tabName);
            });

            const activeStyle = `background-color: var(--accent-primary); color: var(--bg-dark); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);`;
            const inactiveStyle = `color: var(--text-dim); background-color: transparent;`;

            Object.keys(buttons).forEach(key => {
                const btn = buttons[key];
                btn.style.cssText = key === tabName ? activeStyle : inactiveStyle;
            });
            
            if (tabName === 'quiz') {
                renderQuizTable();
            }
            if (tabName === 'ordering') {
                renderOrderingGame();
            }
        };

        // --- Timeline View Logic (Rowspan Fix & Colors) ---
        function renderTimeline() {
            const tbody = document.getElementById('timeline-body');
            tbody.innerHTML = '';
            
            let overallIndex = 0;
            
            groupedData.forEach((group) => {
                const rowSpan = group.pms.length;

                group.pms.forEach((pm, pmIndex) => {
                    const row = document.createElement('tr');
                    // Alternating background for PM rows within the group
                    const bgColor = overallIndex % 2 === 0 ? 'var(--bg-card)' : 'var(--bg-card)90'; 
                    row.style.backgroundColor = bgColor;
                    
                    let rowContent = '';
                    
                    // Col 1: Index
                    rowContent += `<td class="py-3 px-4 text-xs border-b" style="color: var(--text-dim); border-color: var(--bg-dark);">${overallIndex + 1}</td>`;
                    
                    // Col 2: PM
                    rowContent += `<td class="py-3 px-4 font-medium border-b" style="border-color: var(--bg-dark);">${pm}</td>`;
                    
                    // Col 3: President (Only for the first row of the group, using rowspan)
                    if (pmIndex === 0) {
                        rowContent += `
                            <td rowspan="${rowSpan}" class="py-3 px-4 president-cell border-b" style="border-color: var(--bg-dark);">
                                ${group.pres}
                            </td>
                        `;
                    }
                    
                    row.innerHTML = rowContent;
                    tbody.appendChild(row);
                    overallIndex++;
                });
            });
        }


        // --- Flashcard Logic ---
        window.flipCard = function() {
            cardInner.classList.toggle('rotate-y-180');
        };

        function updateCard() {
            cardPM.textContent = cardData[currentCardIndex].pm;
            cardPres.textContent = cardData[currentCardIndex].pres;
            cardCounter.textContent = `${currentCardIndex + 1} / ${cardData.length}`;
            cardInner.classList.remove('rotate-y-180'); // Ensure it starts front-facing
        }

        window.nextCard = function() {
            currentCardIndex = (currentCardIndex + 1) % cardData.length;
            updateCard();
        };

        window.prevCard = function() {
            currentCardIndex = (currentCardIndex - 1 + cardData.length) % cardData.length;
            updateCard();
        };

        window.shuffleCards = function() {
            shuffleArray(cardData);
            currentCardIndex = 0;
            updateCard();
        };


        // --- Ordering Game Logic (New Practice Method) ---
        window.renderOrderingGame = function() {
            // 1. Reset state
            shuffledPMs = [...correctOrderPMs];
            shuffleArray(shuffledPMs);
            currentTargetIndex = 0;
            
            orderingResults.className = 'mt-4 text-base font-bold text-center p-3 rounded-lg border-2';
            orderingResults.style.cssText = `background-color: var(--bg-dark); border-color: var(--accent-primary); color: var(--accent-dark);`;
            orderingResults.innerHTML = 'לחצו על ראשי הממשלה בסדר כרונולוגי נכון.';
            
            // 2. Render shuffled list
            orderingColumn.innerHTML = ``; // Clear column

            shuffledPMs.forEach((pm) => {
                const pmEl = document.createElement('button');
                pmEl.textContent = pm;
                pmEl.setAttribute('data-pm', pm); // Store the name
                pmEl.setAttribute('data-clicked', 'false');
                pmEl.classList.add('order-item', 'w-full', 'sm:w-1/2', 'lg:w-1/3', 'py-3', 'px-4', 'rounded-lg', 'font-medium', 'text-center', 'transition', 'duration-200', 'shadow-md', 'flex-grow');
                pmEl.style.cssText = `background-color: var(--bg-card); color: var(--text-light); border: 2px solid var(--bg-dark);`;
                pmEl.onclick = () => handleOrderClick(pmEl);
                orderingColumn.appendChild(pmEl);
            });
        }

        function handleOrderClick(element) {
            if (element.getAttribute('data-clicked') === 'true') return;

            const pmName = element.getAttribute('data-pm');
            const targetPM = correctOrderPMs[currentTargetIndex];

            if (normalizeAndCompare(pmName, targetPM)) {
                // Correct click
                element.setAttribute('data-clicked', 'true');
                element.style.cssText = `background-color: var(--color-correct); color: var(--bg-dark); border-color: var(--color-correct);`;
                element.innerHTML = `<span class="text-xl font-extrabold mr-2" style="color: var(--bg-dark);"> ${currentTargetIndex + 1}.</span> ${pmName}`;
                currentTargetIndex++;
                
                if (currentTargetIndex === correctOrderPMs.length) {
                    // Game finished
                    orderingResults.style.cssText = `background-color: var(--color-correct); border-color: var(--color-correct); color: var(--bg-dark);`;
                    orderingResults.innerHTML = `<strong>ניצחון! סיימתם את הסדר הכרונולוגי בהצלחה! (20/20)</strong>`;
                    // Disable all remaining buttons (optional, since they are all clicked)
                    document.querySelectorAll('.order-item').forEach(btn => btn.onclick = null); 
                } else {
                    orderingResults.style.cssText = `background-color: var(--bg-dark); border-color: var(--accent-primary); color: var(--accent-primary);`;
                    orderingResults.innerHTML = `נכון! מחפשים כעת את ראש הממשלה ה- ${currentTargetIndex + 1} (הבא בתור).`;
                }

            } else {
                // Incorrect click
                element.style.cssText = `background-color: var(--color-incorrect); color: var(--bg-dark); border-color: var(--color-incorrect);`;
                
                orderingResults.style.cssText = `background-color: var(--color-incorrect); border-color: var(--color-incorrect); color: var(--bg-dark);`;
                orderingResults.innerHTML = `<strong>שגוי!</strong> ראש הממשלה שהתקבל הוא ${pmName}. ראש הממשלה הנדרש היה: ${targetPM}.`;
                
                // Reset the game after a short delay
                setTimeout(() => {
                    renderOrderingGame();
                }, 4000); // 4 seconds delay before reset
            }
        }


        // --- Quiz Logic (Free Text & Rowspan inputs) ---
        function renderQuizTable() {
            quizBody.innerHTML = '';
            quizResults.innerHTML = '';
            
            let overallIndex = 0;

            groupedData.forEach((group, groupIndex) => {
                const rowSpan = group.pms.length;

                group.pms.forEach((pm, pmIndex) => {
                    const row = document.createElement('tr');
                    
                    const bgColor = overallIndex % 2 === 0 ? 'var(--bg-card)' : 'var(--bg-card)90'; 
                    row.style.backgroundColor = bgColor;
                    row.setAttribute('data-correct-pm', pm); // Store correct PM for comparison
                    
                    let rowContent = '';
                    
                    // Col 1: Index
                    rowContent += `<td class="py-3 px-4 text-xs border-b" style="color: var(--text-dim); border-color: var(--bg-dark);">${overallIndex + 1}</td>`;
                    
                    // Col 2: PM Input (Every row gets an input for PM)
                    rowContent += `
                        <td class="py-2 px-4 border-b" style="border-color: var(--bg-dark);">
                            <input type="text" id="quiz-pm-input-${overallIndex}" class="quiz-input" placeholder="שם ראש הממשלה" required>
                        </td>
                    `;
                    
                    // Col 3: President Input (Only for the first row of the group, using rowspan)
                    if (pmIndex === 0) {
                        rowContent += `
                            <td rowspan="${rowSpan}" class="py-2 px-4 border-b president-cell" style="vertical-align: middle; border-color: var(--bg-dark);">
                                <input type="text" id="quiz-pres-input-group-${groupIndex}" class="quiz-input" placeholder="שם הנשיא המכהן" required 
                                       data-correct-pres="${group.pres}">
                            </td>
                        `;
                    }
                    
                    row.innerHTML = rowContent;
                    quizBody.appendChild(row);
                    overallIndex++;
                });
            });
        }
        
        window.checkQuiz = function() {
            let correctPMs = 0;
            let correctPresidents = 0;
            const totalPMs = rawData.length;
            const totalPresGroups = groupedData.length;
            
            // Clear previous highlights
            document.querySelectorAll('.quiz-input').forEach(el => el.classList.remove('correct', 'incorrect'));
            document.querySelectorAll('#quiz-body tr').forEach(el => el.classList.remove('quiz-result-correct', 'quiz-result-incorrect'));

            // 1. Check PMs (one input per row)
            for (let i = 0; i < totalPMs; i++) {
                const pmInput = document.getElementById(`quiz-pm-input-${i}`);
                const row = pmInput.closest('tr');
                const correctPm = row.getAttribute('data-correct-pm');
                const userPm = pmInput.value;

                if (normalizeAndCompare(userPm, correctPm)) {
                    correctPMs++;
                    pmInput.classList.add('correct');
                } else {
                    pmInput.classList.add('incorrect');
                }
            }

            // 2. Check Presidents (one input per group)
            groupedData.forEach((group, groupIndex) => {
                const presInput = document.getElementById(`quiz-pres-input-group-${groupIndex}`);
                if (!presInput) return; // Skip if element doesn't exist (shouldn't happen)
                
                const userPres = presInput.value;
                const correctPres = presInput.getAttribute('data-correct-pres');
                
                const isCorrect = normalizeAndCompare(userPres, correctPres);
                
                // Find the first row of the group to apply the result class
                const firstRowOfGroup = presInput.closest('tr');
                const rowSpan = firstRowOfGroup.querySelector('td[rowspan]').rowSpan;

                // Apply highlighting to all rows in the group
                let currentRow = firstRowOfGroup;
                for (let i = 0; i < rowSpan; i++) {
                    if (currentRow) {
                        if (isCorrect) {
                            currentRow.classList.add('quiz-result-correct');
                        } else {
                            currentRow.classList.add('quiz-result-incorrect');
                        }
                        // Move to the next sibling row
                        currentRow = currentRow.nextElementSibling;
                    }
                }
                
                if (isCorrect) {
                    correctPresidents++;
                    presInput.classList.add('correct');
                } else {
                    presInput.classList.add('incorrect');
                }
            });

            // Calculate overall score
            const totalScoreableItems = totalPMs + totalPresGroups;
            const totalCorrect = correctPMs + correctPresidents;
            const overallScore = (totalCorrect / totalScoreableItems) * 100;
            
            // Display Results
            quizResults.className = 'mt-4 text-lg font-bold p-3 rounded-lg text-center border-2';
            
            let message = '';

            if (overallScore === 100) {
                message = `<strong>כל הכבוד! ציון מושלם: ${totalCorrect} מתוך ${totalScoreableItems} (100%)</strong>.`;
                quizResults.style.color = 'var(--accent-primary)';
                quizResults.style.borderColor = 'var(--accent-primary)';
            } else if (overallScore >= 70) {
                message = `<strong>ציון טוב: ${totalCorrect} מתוך ${totalScoreableItems} (${overallScore.toFixed(0)}%)</strong>. (${correctPMs} ראשי ממשלה, ${correctPresidents} נשיאים).`;
                quizResults.style.color = 'var(--color-correct)'; 
                quizResults.style.borderColor = 'var(--color-correct)';
            } else {
                message = `<strong>ציון: ${totalCorrect} מתוך ${totalScoreableItems} (${overallScore.toFixed(0)}%)</strong>. המשיכו להתאמן!`;
                quizResults.style.color = 'var(--color-incorrect)';
                quizResults.style.borderColor = 'var(--color-incorrect)';
            }
            
            quizResults.style.backgroundColor = 'var(--bg-card)';
            quizResults.innerHTML = message;
        };


        // Run Init
        window.onload = init;

    </script>
</body>
</html>
