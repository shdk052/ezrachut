<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מנהיגי ישראל: ראשי ממשלה ונשיאים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* <!-- Chosen Palette: Deep Cyan-Blue & Vibrant Muted Turquoise --> */
        :root {
            --bg-dark: #0A2B35;      /* Deep Cyan-Blue (Very Dark) */
            --bg-card: #153F4A;      /* Dark Teal/Cyan for cards */
            --accent-teal: #4AD7D1;  /* Vibrant Muted Turquoise */
            --accent-dark: #1F8D88;  /* Darker accent for borders */
            --text-light: #EAF8F8;   /* Light Cyan-White for text */
            --text-dim: #739AA1;     /* Muted gray-cyan for secondary text */
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* הסתרת פס גלילה אך שמירה על פונקציונליות */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* סגנון מיוחד לעמודת הנשיא הממוזגת (הדגשת ה-rowspan) */
        .president-cell {
            background-color: var(--bg-dark); /* רקע כהה מאוד להדגשת הקבוצה */
            color: var(--accent-teal);
            font-weight: bold;
            vertical-align: top !important; /* תמיד למעלה כדי להראות התחלה של קבוצה */
            text-align: center;
            border-left: 2px solid var(--accent-dark); /* הפרדה ויזואלית חזקה */
        }
        
        /* הוספה מיוחדת לטבלה כדי לשפר נראות בטלפון */
        @media (max-width: 640px) {
            .timeline-table td, .timeline-table th {
                padding: 0.5rem 0.5rem; /* הקטנת ריווח בטבלה */
                font-size: 0.875rem; /* Small text */
            }
        }

        /* סגנון לקלט המבחן - מראה של שדה טקסט פתוח */
        .quiz-input {
            background-color: var(--bg-dark);
            color: var(--text-light);
            border: 1px solid var(--accent-dark);
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
            text-align: center;
        }
        /* הדגשת שדה קלט נכון */
        .quiz-input.correct {
            background-color: rgba(74, 215, 209, 0.2); 
            border-color: var(--accent-teal);
        }
        /* הדגשת שדה קלט שגוי */
        .quiz-input.incorrect {
            background-color: rgba(255, 99, 132, 0.2);
            border-color: rgb(255, 99, 132);
        }
        /* הדגשת שורה נכונה/שגויה */
        .quiz-result-correct {
            border-bottom: 2px solid var(--accent-teal);
        }
        .quiz-result-incorrect {
            border-bottom: 2px solid rgb(255, 99, 132);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="bg-[#153F4A] border-b border-[#1F8D88] shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-[#4AD7D1]">מנהיגי ישראל</h1>
                <p class="text-xs text-[#739AA1]">כרונולוגיה של ראשי ממשלה ונשיאים</p>
            </div>
            <!-- Mobile Menu / Tabs -->
            <nav class="flex space-x-2 space-x-reverse bg-[#0A2B35] rounded-lg p-1">
                <button onclick="switchTab('timeline')" id="btn-timeline" class="px-3 py-2 rounded-md text-sm font-medium transition-colors bg-[#4AD7D1] text-[#0A2B35] shadow-md">רשימה</button>
                <button onclick="switchTab('flashcards')" id="btn-flashcards" class="px-3 py-2 rounded-md text-sm font-medium transition-colors text-[#739AA1] hover:text-[#EAF8F8]">כרטיסיות</button>
                <button onclick="switchTab('quiz')" id="btn-quiz" class="px-3 py-2 rounded-md text-sm font-medium transition-colors text-[#739AA1] hover:text-[#EAF8F8]">מבחן</button>
                <button onclick="switchTab('insights')" id="btn-insights" class="px-3 py-2 rounded-md text-sm font-medium transition-colors text-[#739AA1] hover:text-[#EAF8F8]">ניתוח</button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-6">

        <!-- VIEW 1: TIMELINE (The Consolidated Table) -->
        <section id="view-timeline" class="block animate-fade-in">
            <div class="mb-6 bg-[#153F4A] p-4 rounded-xl border-r-4 border-[#4AD7D1]">
                <h2 class="text-xl font-bold mb-2 text-[#EAF8F8]">רשימה כרונולוגית (ממוזגת)</h2>
                <p class="text-[#739AA1] text-sm leading-relaxed">
                    מקטע זה מציג את סדר כהונתם של ראשי ממשלת ישראל. הנשיאים מוצגים במבנה ממוזג (rowspan) כדי להדגיש את החפיפה. **שימו לב** להבדל בין התאים הממוזגים: ריבלין (שורה קטנה) לעומת הרצוג (שורות מרובות).
                </p>
            </div>

            <div class="overflow-x-auto rounded-xl border border-[#2C5761] shadow-2xl">
                <table class="w-full text-right bg-[#153F4A] min-w-[500px] timeline-table">
                    <thead class="bg-[#0A2B35] text-[#4AD7D1]">
                        <tr>
                            <th class="py-4 px-4 font-bold border-b border-[#2C5761]">#</th>
                            <th class="py-4 px-4 font-bold border-b border-[#2C5761]">ראש ממשלה</th>
                            <th class="py-4 px-4 font-bold border-b border-[#2C5761] w-1/3">נשיא מכהן</th>
                        </tr>
                    </thead>
                    <tbody id="timeline-body" class="divide-y divide-[#2C5761] text-[#EAF8F8]">
                        <!-- Data will be injected here via JS with Rowspan -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- VIEW 2: FLASHCARDS (Study Tool) -->
        <section id="view-flashcards" class="hidden">
            <div class="mb-6 text-center">
                <h2 class="text-xl font-bold text-[#EAF8F8]">כרטיסיות ושינון</h2>
                <p class="text-[#739AA1] text-sm leading-relaxed">
                    <strong>שיטות למידה:</strong> נסו לשייך מילה, אירוע היסטורי או רעיון משותף לכל צמד מנהיגים כדי לחזק את הזיכרון. 
                    לחצו על הכרטיס כדי לחשוף את הנשיא שכיהן במקביל לראש הממשלה.
                </p>
            </div>

            <!-- Flashcard Container (Unchanged) -->
            <div class="flex flex-col items-center justify-center min-h-[400px]">
                <div class="group w-full max-w-sm h-64 cursor-pointer perspective-1000" onclick="flipCard()">
                    <div id="flashcard-inner" class="relative w-full h-full duration-500 transform-style-3d shadow-xl rounded-2xl">
                        <div class="absolute w-full h-full bg-[#153F4A] border-2 border-[#4AD7D1] rounded-2xl p-6 flex flex-col items-center justify-center backface-hidden">
                            <span class="text-[#4AD7D1] text-sm font-bold tracking-wider mb-4">ראש ממשלה</span>
                            <h3 id="card-pm" class="text-3xl font-extrabold text-[#EAF8F8] text-center">--</h3>
                            <div class="mt-6 text-[#739AA1] text-xs">לחץ לחשיפת הנשיא</div>
                        </div>
                        <div class="absolute w-full h-full bg-[#4AD7D1] rounded-2xl p-6 flex flex-col items-center justify-center backface-hidden rotate-y-180">
                            <span class="text-[#0A2B35] text-sm font-bold tracking-wider mb-4">נשיא מכהן</span>
                            <h3 id="card-president" class="text-3xl font-extrabold text-[#0A2B35] text-center">--</h3>
                            <div class="mt-6 text-[#0A2B35]/70 text-xs">לחץ לחזרה</div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center space-x-4 space-x-reverse mt-8">
                    <button onclick="prevCard()" class="p-3 rounded-full bg-[#2C5761] hover:bg-[#396D78] text-white transition shadow-lg">
                        &#8594; הקודם
                    </button>
                    <span id="card-counter" class="text-[#739AA1] font-mono">1 / 20</span>
                    <button onclick="nextCard()" class="p-3 rounded-full bg-[#4AD7D1] hover:bg-[#1F8D88] text-white transition shadow-lg">
                        הבא &#8592;
                    </button>
                </div>

                <button onclick="shuffleCards()" class="mt-6 text-sm text-[#4AD7D1] hover:text-[#76F7F7] underline">ערבב כרטיסים</button>
            </div>
        </section>
        
        <!-- VIEW 3: QUIZ (Test Feature - Free Text Input) -->
        <section id="view-quiz" class="hidden">
            <div class="mb-6 bg-[#153F4A] p-4 rounded-xl border-r-4 border-[#4AD7D1]">
                <h2 class="text-xl font-bold mb-2 text-[#EAF8F8]">מבחן ידע: מילוי טבלה חופשי</h2>
                <p class="text-[#739AA1] text-sm leading-relaxed">
                    מלאו את הטבלה כולה מהזיכרון. המערכת תזהה את התשובות הנכונות גם אם יש שגיאות כתיב קלות (כגון 'בינימין' במקום 'בנימין').
                </p>
                <button onclick="checkQuiz()" class="mt-4 px-6 py-2 bg-[#4AD7D1] text-[#0A2B35] font-bold rounded-lg shadow-md hover:bg-[#1F8D88] hover:text-[#EAF8F8] transition-colors">
                    בדיקת תשובות וקבלת ציון
                </button>
                <div id="quiz-results" class="mt-4 text-lg font-bold"></div>
            </div>

            <div class="overflow-x-auto rounded-xl border border-[#2C5761] shadow-2xl">
                <form id="quiz-form" onsubmit="event.preventDefault(); checkQuiz();">
                    <table class="w-full text-right bg-[#153F4A] min-w-[500px] timeline-table">
                        <thead class="bg-[#0A2B35] text-[#4AD7D1]">
                            <tr>
                                <th class="py-4 px-4 font-bold border-b border-[#2C5761]">#</th>
                                <th class="py-4 px-4 font-bold border-b border-[#2C5761]">ראש ממשלה (כתיבה חופשית)</th>
                                <th class="py-4 px-4 font-bold border-b border-[#2C5761] w-1/3">נשיא מכהן (כתיבה חופשית)</th>
                            </tr>
                        </thead>
                        <tbody id="quiz-body" class="divide-y divide-[#2C5761] text-[#EAF8F8]">
                            <!-- Quiz rows will be injected here -->
                        </tbody>
                    </table>
                </form>
            </div>
        </section>

        <!-- VIEW 4: INSIGHTS (Analytics) -->
        <section id="view-insights" class="hidden">
            <div class="mb-6 bg-[#153F4A] p-4 rounded-xl border-r-4 border-[#4AD7D1]">
                <h2 class="text-xl font-bold mb-2 text-[#EAF8F8]">ניתוח נתונים</h2>
                <p class="text-[#739AA1] text-sm leading-relaxed">
                    מבט ויזואלי על התדירות בה מנהיגים הופיעו ברשימה הכרונולוגית. הגרפים מציגים כמה כהונות (או תקופות חפיפה) נרשמו לכל ראש ממשלה ולכל נשיא על פי הנתונים שסופקו.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Chart 1: PM Occurrences -->
                <div class="bg-[#153F4A] p-4 rounded-xl shadow-lg border border-[#2C5761]">
                    <h3 class="text-center text-[#4AD7D1] font-bold mb-4">מספר הופעות ברשימה: ראשי ממשלה</h3>
                    <div class="chart-container">
                        <canvas id="pmChart"></canvas>
                    </div>
                </div>

                <!-- Chart 2: President Occurrences -->
                <div class="bg-[#153F4A] p-4 rounded-xl shadow-lg border border-[#2C5761]">
                    <h3 class="text-center text-[#4AD7D1] font-bold mb-4">מספר הופעות ברשימה: נשיאים</h3>
                    <div class="chart-container">
                        <canvas id="presidentChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-[#0A2B35] border-t border-[#153F4A] py-6 text-center">
        <p class="text-[#51767C] text-sm">נוצר על בסיס נתוני רשימת ראשי הממשלה והנשיאים</p>
    </footer>

    <script>
        // --- Data Source ---
        const rawData = [
            { pm: "דוד בן גוריון", pres: "חיים ויצמן" },
            { pm: "משה שרת", pres: "יצחק בן צבי" },
            { pm: "דוד בן גוריון", pres: "יצחק בן צבי" },
            { pm: "לוי אשכול", pres: "זלמן שזר" },
            { pm: "גולדה מאיר", pres: "אפרים קציר" },
            { pm: "יצחק רבין", pres: "אפרים קציר" },
            { pm: "מנחם בגין", pres: "יצחק נבון" },
            { pm: "יצחק שמיר", pres: "חיים הרצוג" },
            { pm: "שמעון פרס", pres: "חיים הרצוג" },
            { pm: "יצחק שמיר", pres: "חיים הרצוג" },
            { pm: "יצחק רבין", pres: "עזר ויצמן" },
            { pm: "שמעון פרס", pres: "עזר ויצמן" },
            { pm: "בנימין נתניהו", pres: "עזר ויצמן" },
            { pm: "אהוד ברק", pres: "משה קצב" },
            { pm: "אריאל שרון", pres: "משה קצב" },
            { pm: "אהוד אולמרט", pres: "שמעון פרס" },
            { pm: "בנימין נתניהו", pres: "ראובן ריבלין" }, // Group size 1
            { pm: "נפתלי בנט", pres: "יצחק הרצוג" },
            { pm: "יאיר לפיד", pres: "יצחק הרצוג" },
            { pm: "בנימין נתניהו", pres: "יצחק הרצוג" }  // Group size 3
        ];

        // --- Data Grouping (Logic for Consolidated Table/Quiz Structure) ---
        function groupData(data) {
            const groups = [];
            let currentPresident = null;
            
            data.forEach(item => {
                if (!currentPresident || currentPresident.pres !== item.pres) {
                    currentPresident = { pres: item.pres, pms: [] };
                    groups.push(currentPresident);
                }
                currentPresident.pms.push(item.pm);
            });
            return groups;
        }

        const groupedData = groupData(rawData);

        // --- App State & DOM ---
        let currentCardIndex = 0;
        let cardData = [...rawData]; 
        
        const views = {
            timeline: document.getElementById('view-timeline'),
            flashcards: document.getElementById('view-flashcards'),
            quiz: document.getElementById('view-quiz'), 
            insights: document.getElementById('view-insights')
        };
        const buttons = {
            timeline: document.getElementById('btn-timeline'),
            flashcards: document.getElementById('btn-flashcards'),
            quiz: document.getElementById('btn-quiz'), 
            insights: document.getElementById('btn-insights')
        };
        const cardInner = document.getElementById('flashcard-inner');
        const cardPM = document.getElementById('card-pm');
        const cardPres = document.getElementById('card-president');
        const cardCounter = document.getElementById('card-counter');
        const quizBody = document.getElementById('quiz-body');
        const quizResults = document.getElementById('quiz-results');

        // --- Initialization ---
        function init() {
            renderTimeline();
            renderQuizTable(); 
            updateCard();
            renderCharts();
        }

        // --- Levenshtein Distance for Fuzzy Matching ---
        /**
         * מחשב את מרחק לוינשטיין בין שתי מחרוזות.
         * משמש להערכת דמיון למרות שגיאות כתיב קלות.
         */
        function levenshteinDistance(s1, s2) {
            s1 = s1.toLowerCase().replace(/\s/g, '');
            s2 = s2.toLowerCase().replace(/\s/g, '');

            const costs = [];
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0) {
                        costs[j] = j;
                    } else if (j > 0) {
                        let newValue = costs[j - 1];
                        if (s1[i - 1] !== s2[j - 1]) {
                            newValue = Math.min(newValue, lastValue, costs[j]) + 1;
                        }
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                    }
                }
                if (i > 0) {
                    costs[s2.length] = lastValue;
                }
            }
            return costs[s2.length];
        }

        /**
         * משווה מחרוזת של משתמש מול תשובה נכונה עם סובלנות לשגיאות כתיב.
         * מנרמל ע"י הסרת תווים שאינם אותיות עבריות ומרחקים.
         */
        function normalizeAndCompare(userStr, correctStr) {
            if (!userStr || !correctStr) return false;

            // ניקוי: הסרת תווים שאינם אותיות עבריות (כולל ניקוד, למרות שסביר שלא יהיה).
            const cleanUser = userStr.replace(/[^\u0590-\u05FF]/g, '').toLowerCase();
            const cleanCorrect = correctStr.replace(/[^\u0590-\u05FF]/g, '').toLowerCase();

            if (cleanUser.length === 0 || cleanCorrect.length === 0) return false;

            const distance = levenshteinDistance(cleanUser, cleanCorrect);
            
            // הגדרת סובלנות:
            let tolerance;
            if (cleanCorrect.length < 5) {
                tolerance = 0; // חובה מדויק לשמות קצרים
            } else if (cleanCorrect.length < 10) {
                tolerance = 1; // שגיאה אחת מותרת
            } else {
                tolerance = 2; // שתי שגיאות מותרות לשמות ארוכים (כמו בנימין נתניהו)
            }

            return distance <= tolerance;
        }

        // --- Tab Switching Logic (Unchanged) ---
        window.switchTab = function(tabName) {
            Object.keys(views).forEach(key => {
                views[key].classList.toggle('hidden', key !== tabName);
                views[key].classList.toggle('block', key === tabName);
            });

            const activeColor = "bg-[#4AD7D1] text-[#0A2B35] shadow-md";
            const inactiveColor = "text-[#739AA1] hover:text-[#EAF8F8]";

            Object.keys(buttons).forEach(key => {
                const btn = buttons[key];
                btn.className = `px-3 py-2 rounded-md text-sm font-medium transition-colors ${key === tabName ? activeColor : inactiveColor}`;
            });
            
            if (tabName === 'quiz') {
                renderQuizTable(); // Render/Reset quiz table when switching to it
            }
        };

        // --- Timeline View Logic (Rowspan Fix) ---
        function renderTimeline() {
            const tbody = document.getElementById('timeline-body');
            tbody.innerHTML = '';
            
            let overallIndex = 0;
            
            groupedData.forEach((group) => {
                const rowSpan = group.pms.length;

                group.pms.forEach((pm, pmIndex) => {
                    const row = document.createElement('tr');
                    // Alternating background for PM rows within the group
                    row.className = overallIndex % 2 === 0 ? 'bg-[#153F4A]' : 'bg-[#153F4A]/50'; 
                    
                    let rowContent = '';
                    
                    // Col 1: Index
                    rowContent += `<td class="py-3 px-4 text-[#739AA1] text-xs border-b border-[#2C5761]">${overallIndex + 1}</td>`;
                    
                    // Col 2: PM
                    rowContent += `<td class="py-3 px-4 font-medium border-b border-[#2C5761]">${pm}</td>`;
                    
                    // Col 3: President (Only for the first row of the group, using rowspan)
                    if (pmIndex === 0) {
                        rowContent += `
                            <td rowspan="${rowSpan}" class="py-3 px-4 president-cell border-b border-[#2C5761]">
                                ${group.pres}
                            </td>
                        `;
                    }
                    
                    row.innerHTML = rowContent;
                    tbody.appendChild(row);
                    overallIndex++;
                });
            });
        }


        // --- Flashcard Logic (Unchanged) ---
        window.flipCard = function() {
            // ... (Flashcard logic remains the same)
        };

        function updateCard() {
            // ... (Flashcard logic remains the same)
        }

        window.nextCard = function() {
            // ... (Flashcard logic remains the same)
        };

        window.prevCard = function() {
            // ... (Flashcard logic remains the same)
        };

        window.shuffleCards = function() {
            // ... (Flashcard logic remains the same)
        };

        // --- Quiz Logic (Updated for Free Text & Rowspan inputs) ---
        function renderQuizTable() {
            quizBody.innerHTML = '';
            quizResults.innerHTML = '';
            
            let overallIndex = 0;

            groupedData.forEach((group, groupIndex) => {
                const rowSpan = group.pms.length;

                group.pms.forEach((pm, pmIndex) => {
                    const row = document.createElement('tr');
                    
                    row.className = overallIndex % 2 === 0 ? 'bg-[#153F4A]' : 'bg-[#153F4A]/50'; 
                    row.setAttribute('data-correct-pm', pm); // Store correct PM for comparison
                    
                    let rowContent = '';
                    
                    // Col 1: Index
                    rowContent += `<td class="py-3 px-4 text-[#739AA1] text-xs border-b border-[#2C5761]">${overallIndex + 1}</td>`;
                    
                    // Col 2: PM Input (Every row gets an input for PM)
                    rowContent += `
                        <td class="py-2 px-4 border-b border-[#2C5761]">
                            <input type="text" id="quiz-pm-input-${overallIndex}" class="quiz-input" placeholder="שם ראש הממשלה" required>
                        </td>
                    `;
                    
                    // Col 3: President Input (Only for the first row of the group, using rowspan)
                    if (pmIndex === 0) {
                        rowContent += `
                            <td rowspan="${rowSpan}" class="py-2 px-4 border-b border-[#2C5761] president-cell" style="vertical-align: middle;">
                                <input type="text" id="quiz-pres-input-group-${groupIndex}" class="quiz-input" placeholder="שם הנשיא המכהן" required 
                                       data-correct-pres="${group.pres}">
                            </td>
                        `;
                    }
                    
                    row.innerHTML = rowContent;
                    quizBody.appendChild(row);
                    overallIndex++;
                });
            });
        }
        
        window.checkQuiz = function() {
            let correctPMs = 0;
            let correctPresidents = 0;
            const totalPMs = rawData.length;
            const totalPresGroups = groupedData.length;
            
            // Clear previous highlights
            document.querySelectorAll('.quiz-input').forEach(el => el.classList.remove('correct', 'incorrect'));
            document.querySelectorAll('#quiz-body tr').forEach(el => el.classList.remove('quiz-result-correct', 'quiz-result-incorrect'));

            // 1. Check PMs (one input per row)
            for (let i = 0; i < totalPMs; i++) {
                const pmInput = document.getElementById(`quiz-pm-input-${i}`);
                const row = pmInput.closest('tr');
                const correctPm = row.getAttribute('data-correct-pm');
                const userPm = pmInput.value;

                if (normalizeAndCompare(userPm, correctPm)) {
                    correctPMs++;
                    pmInput.classList.add('correct');
                } else {
                    pmInput.classList.add('incorrect');
                }
            }

            // 2. Check Presidents (one input per group)
            groupedData.forEach((group, groupIndex) => {
                const presInput = document.getElementById(`quiz-pres-input-group-${groupIndex}`);
                const userPres = presInput.value;
                const correctPres = presInput.getAttribute('data-correct-pres');
                
                const groupRows = document.querySelectorAll(`[data-correct-pm="${group.pms[0]}"]`); // Use the first PM as anchor
                
                let isCorrect = normalizeAndCompare(userPres, correctPres);
                
                if (isCorrect) {
                    correctPresidents++;
                    presInput.classList.add('correct');
                    groupRows.forEach(row => row.classList.add('quiz-result-correct'));
                } else {
                    presInput.classList.add('incorrect');
                    groupRows.forEach(row => row.classList.add('quiz-result-incorrect'));
                }
            });

            // Calculate overall score
            const totalScoreableItems = totalPMs + totalPresGroups;
            const totalCorrect = correctPMs + correctPresidents;
            const overallScore = (totalCorrect / totalScoreableItems) * 100;
            
            // Display Results
            quizResults.className = 'mt-4 text-lg font-bold p-3 rounded-lg text-center';
            
            let message = '';
            let styleClass = '';

            if (overallScore === 100) {
                styleClass = 'text-[#4AD7D1] bg-[#1F8D88]/50';
                message = `<strong>כל הכבוד! ציון מושלם: ${totalCorrect} מתוך ${totalScoreableItems} (100%)</strong>.`;
            } else if (overallScore >= 70) {
                styleClass = 'text-yellow-400 bg-[#1F8D88]/50';
                message = `<strong>ציון טוב: ${totalCorrect} מתוך ${totalScoreableItems} (${overallScore.toFixed(0)}%)</strong>. (${correctPMs} ראשי ממשלה, ${correctPresidents} נשיאים).`;
            } else {
                styleClass = 'text-red-400 bg-[#153F4A]/50';
                message = `<strong>ציון: ${totalCorrect} מתוך ${totalScoreableItems} (${overallScore.toFixed(0)}%)</strong>. המשיכו להתאמן!`;
            }

            quizResults.classList.add(...styleClass.split(' '));
            quizResults.innerHTML = message;
        };


        // --- Insights View Logic (Charts - Unchanged) ---
        function renderCharts() {
            // ... (Chart logic remains the same)
            const pmCounts = {};
            const presCounts = {};

            rawData.forEach(item => {
                pmCounts[item.pm] = (pmCounts[item.pm] || 0) + 1;
                presCounts[item.pres] = (presCounts[item.pres] || 0) + 1;
            });

            const chartConfig = (labels, data, label) => ({
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: '#4AD7D1', 
                        borderColor: '#1F8D88',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', 
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#0A2B35',
                            titleColor: '#4AD7D1',
                            bodyColor: '#EAF8F8',
                            borderColor: '#2C5761',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#739AA1', stepSize: 1 },
                            grid: { color: '#2C5761' }
                        },
                        y: {
                            ticks: { color: '#EAF8F8', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });

            const existingPmChart = Chart.getChart('pmChart');
            if (existingPmChart) existingPmChart.destroy();
            new Chart(
                document.getElementById('pmChart'),
                chartConfig(Object.keys(pmCounts), Object.values(pmCounts), 'מספר כהונות ברשימה')
            );

            const existingPresChart = Chart.getChart('presidentChart');
            if (existingPresChart) existingPresChart.destroy();
            new Chart(
                document.getElementById('presidentChart'),
                chartConfig(Object.keys(presCounts), Object.values(presCounts), 'מספר כהונות ברשימה')
            );
        }

        // Run Init
        window.onload = init;

    </script>
</body>
</html>
